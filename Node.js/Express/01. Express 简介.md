# Express ç®€ä»‹

Express æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ Node Web æ¡†æ¶ã€‚

> Fast, unopinionated, minimalist web framework for Node.js

## Hello Express
1. `npm init -y` æ–°å»º `package.json` æ–‡ä»¶

2. è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½ Express
```bash
$ npm install express --save
```
3. å°†ä»¥ä¸‹ä»£ç ä¿å­˜æˆ `app.js`ï¼Œè¿è¡Œ `node app.js` å¹¶è®¿é—® http://localhost:3000 ã€‚
```javascript
const express = require('express'); Â  Â  // å¼•å…¥ express æ¨¡å—
const app = express(); Â  Â  Â  Â  Â  Â  Â  Â   // æ–°å»º express app

app.get('/', function(req, res) { Â  Â  Â  // å¤„ç† '/' çš„ GET è¯·æ±‚
 Â res.send('Hello Express!'); Â  Â  Â  Â  Â  // è¿”å› 'Hello Express!'
});

app.listen(3000, function() { Â  Â  Â  Â  Â  // ç›‘å¬ç«¯å£ 3000
 Â console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 3000');
});
```

## é™æ€æ–‡ä»¶æœåŠ¡å™¨
ç›®å½•ç»“æ„ https://github.com/twhy/express-everything/tree/master/static

```javascript
const express = require('express');
const app = express();

app.use(express.static('public')); Â  Â   // public æ–‡ä»¶å¤¹å­˜æ”¾é™æ€æ–‡ä»¶å¦‚ CSS å›¾ç‰‡ç­‰

app.listen(3000, function() {
  console.log('Server listening on port 3000');
});
```
é€šè¿‡ `node app.js` å¯åŠ¨æœåŠ¡å™¨ï¼Œè®¿é—® http://localhost:3000/cat.html æˆ– http://localhost:3000/styles/cat.css ã€‚

## æ¸²æŸ“é¡µé¢
å®‰è£…åŒ… `express` å’Œ `pug`ï¼Œåè€…æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚
```bash
$ npm install express --save
$ npm install pug --save
```
`app.js`
```javascript
const path = require('path');
const express = require('express');
const app = express();

app.set('views', path.join(__dirname, 'views'));      // è®¾ç½® views ç›®å½•è·¯å¾„
app.set('view engine', 'pug');                        // ä½¿ç”¨ pug ä½œä¸ºæ¨¡æ¿å¼•æ“

const CATS = [
  { name: "the Dinotocat", image: "https://octodex.github.com/images/dinotocat.png" },
  { name: "the Benjamin Bannekat", image: "https://octodex.github.com/images/bannekat.png" },
  { name: "the Catstello", image: "https://octodex.github.com/images/catstello.png" }
];

app.get('/', function(req, res) {
  res.render('index', { cats: CATS });
});

app.listen(process.env.PORT || 3000);
```
é¡µé¢æ¨¡æ¿ `index.pug`
```pug
<!DOCTYPE html>
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    meta(http-equiv="X-UA-Compatible", content="ie=edge")
    style.
      body { text-align: center; }
    title Cats
  body
    h1 Cats 
    each cat in cats
      img(src=`${cat.image}` alt=`${cat.name}` width="230")
```
ğŸš€ https://express-cats.now.sh [æºç ](https://github.com/fe13/fe/blob/master/Node.js/Express/01.%20Express%20%E7%AE%80%E4%BB%8B.md)

## Router
ä½¿ç”¨ Express æ¨¡æ‹Ÿ `GET` `POST` `PUT` `DELETE` ç­‰å„ç§è¯·æ±‚ç»“æœåœ¨å‰ç«¯é¡¹ç›®å¼€å‘æœŸé—´ç›¸å½“æœ‰ç”¨ã€‚[æºç ](https://github.com/twhy/express-everything/tree/master/router)

å®‰è£… `express` `pug` `body-parser`ï¼Œå…¶ä¸­ `body-parser` ç”¨äºè§£æè¯·æ±‚ä½“(Request Body)ã€‚
```bash
$ npm install express --save
$ npm install pug --save
$ npm install body-parser --save
```
`app.js`
```javascript
const path = require('path');
const express = require('express');
const bodyParser = require('body-parser');

const app = express();

app.set('views', path.join(__dirname, 'views'));      // è®¾ç½® views ç›®å½•è·¯å¾„
app.set('view engine', 'pug');                        // ä½¿ç”¨ pug ä½œä¸ºæ¨¡æ¿å¼•æ“

app.use(express.static('public'));
app.use(bodyParser.json());                           // application/json
app.use(bodyParser.urlencoded({ extended: false }));  // application/x-www-form-urlencoded

app.get('/', function(req, res) {
  res.render('index');
});

app.use('/cats', require('./cats'));

app.listen(3000, function() {
  console.log('Server listening on port 3000');
});
```
`cats.js`
```javascript
const express = require('express');
const router = express.Router();

router.get('/', function(req, res) {
  res.json([
    { name: "the Dinotocat", image: "https://octodex.github.com/images/dinotocat.png" },
    { name: "the Benjamin Bannekat", image: "https://octodex.github.com/images/bannekat.png" }
  ]);
});

router.post('/', function(req, res) {
  res.json({ message: `æ–°å¢ ${req.body.name}` });
});

router.put('/:name', function(req, res) {
  res.json({ message: `ä¿®æ”¹ ${req.params.name}` });
});

router.delete('/:name', function(req, res) {
  res.json({ message: `åˆ é™¤ ${req.params.name}` });
});

module.exports = router;
```

## CommonJS
Node.js ä½¿ç”¨ CommonJS æ¨¡å—è§„èŒƒï¼Œ`module.exports = router;` æ˜¯å¯¼å‡ºæ¨¡å—çš„æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ `require()` å¯¼å…¥æ¨¡å—ã€‚

## å‚è€ƒé“¾æ¥
* http://expressjs.com
* https://expressjs.com/en/4x/api.html#app
* https://expressjs.com/en/4x/api.html#app.settings.table
* http://expressjs.com/en/guide/error-handling.html
* http://expressjs.com/en/guide/routing.html#express-router
* https://expressjs.com/en/guide/routing.html#response-methods
* http://expressjs.com/en/resources/middleware.html
* https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/Introduction
