# æ¨¡å— Module

`ES6`(ES2015) ä¸º JavaScript å¸¦æ¥äº†è¯­è¨€å±‚é¢çš„æ¨¡å—ç‰¹æ€§ã€‚

## export
`export` è¯­å¥ç”¨äº**å¯¼å‡º**æ¨¡å—å†…çš„ç±»ï¼Œå‡½æ•°ï¼Œå¯¹è±¡ï¼Œæ•°å€¼ç­‰ã€‚

`slider.js`
```javascript
export class Slider {
  // ...
}
```
`lazyload.js`
```javascript

export function lazyload(images) {
  // ...
}
```
`constants.js`
```javascript
export const RECOMMEND_URL = 'https://qq-music-api.now.sh'
export const TOPLIST_URL = 'https://qq-music-api.now.sh/top'
export const SEARCH_URL = 'https://qq-music-api.now.sh/search'
export const LYRICS_URL = 'https://qq-music-api.now.sh/lyrics'
```

## import
`import` è¯­å¥ç”¨äº**å¯¼å…¥**æ¨¡å—å†…çš„ç±»ï¼Œå‡½æ•°ï¼Œå¯¹è±¡ï¼Œæ•°å€¼ç­‰ã€‚

`helpers.js`
```javascript
import { LYRICS_URL } from './constants.js'

export function songUrl(id) {
  return `http://ws.stream.qqmusic.qq.com/${id}.m4a?fromtag=46`
}

export function lyricsUrl(songid) {
  return `${LYRICS_URL}?id=${songid}`
}

export function albumCoverUrl(id) {
  return `https://y.gtimg.cn/music/photo_new/T002R150x150M000${id}.jpg`
}
```

`music_players.js`
```javascript
import { ProgressBar } from './progress_bar.js'
import { LyricsPlayer } from './lyrics_player.js'
import { songUrl, lyricsUrl, albumCoverUrl } from './helpers.js'

export class MusicPlayer {
  // ...
}
```

`app.js`
```javascript
import './tab.js'    // æ‰§è¡Œ tab.js
import { Search } from './search.js'
import { TopList } from './toplist.js'
import { Recommend } from './recommend.js'
import { MusicPlayer } from './music_player.js'

// ...
```

ğŸ’¡ ä»¥ä¸Šåªæ˜¯ `import` å’Œ `export` çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œæƒ³äº†è§£æ›´å¤šè¯·æŸ¥çœ‹ MDN ç›¸å…³å†…å®¹ã€‚

## æµè§ˆå™¨æ”¯æŒ
Chrome 61 èµ·é€šè¿‡ä»¥ä¸‹æ–¹å¼æ”¯æŒ `ES6` æ¨¡å—ã€‚
```html
<script type="module" src="javascripts/app.js"></script>
```
```html
<script type="module">
  import { lazyload } from './javascripts/lazyload.js'
  lazyload()
</script>
```
å…¼å®¹ä¸æ”¯æŒ `<script type="module">` çš„æµè§ˆå™¨ã€‚
```html
<script type="module" src="javascripts/app.js"></script>
<script nomodule src="dist/app.js"></script>  <!-- Webpack æ‰“åŒ…åçš„ä»£ç  -->
```
ğŸ’¡ æ”¯æŒ `<script type="module">` çš„æµè§ˆå™¨ä¼šå¿½ç•¥ `<script type="nomodule">`ã€‚

## Webpack
Webpack æ˜¯ç›®å‰æœ€æµè¡Œçš„æ‰“åŒ…å·¥å…·ï¼Œæ”¯æŒ ES6 æ¨¡å—ã€‚ä½¿ç”¨ Webpack æ—¶ `import` å¯çœç•¥ `.js` åç¼€ã€‚

å®‰è£… Webpack
```bash
$ npm install -g webpack
```
æ–°å»º `webpack.config.js`
```javascript
module.exports = {
 Â entry: './javascripts/app.js', Â   // å…¥å£æ–‡ä»¶
 Â output: {
 Â  Â filename: 'dist/app.js' Â  Â  Â  Â  // è¾“å‡ºæ–‡ä»¶
 Â }
}
```
è¿è¡Œ `webpack` å‘½ä»¤ç”Ÿæˆ `dist/app.js` ğŸ’¡ å¼€å‘æœŸé—´å¯è¿è¡Œ `webkpack -w`ï¼Œä»¥ä¾¿ä¿å­˜ä»£ç çš„åŒæ—¶è¿›è¡Œæ‰“åŒ…ã€‚
```bash
$ webpack
```
å¼•å…¥æ‰“åŒ…åçš„è„šæœ¬
```html
<script type="module" src="javascripts/app.js"></script> Â <!-- å·²æ”¯æŒ ES6 æ¨¡å—çš„æµè§ˆå™¨ -->
<script nomodule src="dist/app.js"></script> Â  Â  Â  Â  Â  Â   <!-- ä¸æ”¯æŒ ES6 æ¨¡å—çš„æµè§ˆå™¨ -->
```
ğŸ’¡ `webpack -p` å¯ä»¥å°†ä»£ç æ‰“åŒ…å¹¶å‹ç¼©ã€‚

### Babel
ä½¿ç”¨ Babel å°†ä»£ç è½¬æˆ `ES5` ä»¥å…¼å®¹å…¶ä»–æµè§ˆå™¨
```bash
$ npm install --save-dev babel-loader babel-core babel-preset-env webpack
```
æ›´æ–° `webpack.config.js` å¦‚ä¸‹å¹¶è¿è¡Œ `webpack` è¿›è¡Œæ‰“åŒ…ã€‚
```javascript
module.exports = {
  entry: './javascripts/app.js',    // å…¥å£æ–‡ä»¶
  output: {
    filename: 'dist/app.js'         // è¾“å‡ºæ–‡ä»¶
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /(node_modules|bower_components)/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['env']
          }
        }
      }
    ]
  }
}
```

## å‚è€ƒæ¡ˆä¾‹
* [QQ éŸ³ä¹](https://twhy.github.io/qq-music) [æºç ](https://github.com/twhy/qq-music)

## å‚è€ƒé“¾æ¥
* https://webpack.js.org
* https://webpack.js.org/loaders/babel-loader
* https://ponyfoo.com/articles/es6-modules-in-depth
* https://jakearchibald.com/2017/es-modules-in-browsers
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export
