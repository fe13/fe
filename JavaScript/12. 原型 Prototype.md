# åŸå‹ Prototype

JavaScript æ˜¯ä¸€é—¨åŸºäº**åŸå‹**çš„è¯­è¨€ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹(å¯¹è±¡)ä½œä¸ºæ¨¡æ¿ã€‚

é€šè¿‡åŸå‹è¿™ç§æœºåˆ¶ï¼Œå¯¹è±¡èƒ½ä»å…¶ä»–å¯¹è±¡ç»§æ‰¿åŠŸèƒ½ç‰¹æ€§ï¼›è¿™ç§ç»§æ‰¿æœºåˆ¶ä¸ç»å…¸çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸åŒã€‚

## \_\_proto\_\_
æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª `__proto__` å±æ€§ç”¨äºç»§æ‰¿åŠŸèƒ½ç‰¹æ€§ï¼Œè¯¥å±æ€§ä¸æ˜¯æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½†å´æ˜¯**äº‹å®æ ‡å‡†**ã€‚  

å£°æ˜å¯¹è±¡ `fan` å¦‚ä¸‹ï¼Œå½“è®¿é—® `name` `traval()` ç­‰è‡ªèº«å…·æœ‰çš„å±æ€§/æ–¹æ³•æ—¶ï¼Œä¼šä»å¯¹è±¡è‡ªèº«è·å–ï¼›  
å½“è®¿é—® `valueOf()` `toString()` ç­‰éè‡ªèº«å±æ€§/æ–¹æ³•æ—¶ï¼Œä¼šä»(ä¹Ÿåªèƒ½) `__proto__` å±æ€§ä¸Šè·å–ã€‚
```javascript
let fan = {
 Â name: 'å•ç²‰ä¸',
  height: 162,
 Â gender: 'å¥³',
  eat() { return 'åƒé¥­ ğŸš' },
 Â sleep() { return 'ç¡è§‰ ğŸ˜´' },
  sing() { return 'å”±æ­Œ ğŸ¤' },
 Â intro() { return `å¤§å®¶å¥½ï¼æˆ‘æ˜¯${this.name}ã€‚` },
 Â travel() { return 'ç¯æ¸¸ä¸–ç•Œ ğŸŒğŸŒğŸŒ' }
};
```
```javascript
> fan.name
â†’ "å•ç²‰ä¸"

> fan.travel()
â†’ "ç¯æ¸¸ä¸–ç•Œ ğŸŒğŸŒğŸŒ"

> fan.valueOf()
â†’ Object {name: "å•ç²‰ä¸", height: 162, gender: "å¥³", eat: function, sleep: functionâ€¦}
```
## Object.prototype
ä»¥ä¸‹ä»£ç éƒ½æè¿°äº†åŒä¸€ä¸ªäº‹å®ï¼š`Object.prototype`(å¼•ç”¨çš„å¯¹è±¡) æ˜¯ `fan` çš„åŸå‹ã€‚
```javascript
> fan.__proto__ === Object.prototype Â    // fan.__proto__ å’Œ Object.prototype å¼•ç”¨åŒä¸€å¯¹è±¡
â†’ true

> Object.prototype.isPrototypeOf(fan) Â   // Object.prototype(å¼•ç”¨çš„å¯¹è±¡) æ˜¯ fan çš„åŸå‹
â†’ true

> Object.prototype === Object.getPrototypeOf(fan)
â†’ true
```
ğŸ¤” é‚£å¦‚æœ `fan` æ˜¯ `String` / `Array` / `Function` å‘¢ï¼Ÿ

<table>
  <tr>
    <td align="center" colspan="4">
      <strong><code>Object.prototype</code></strong>
    </td>
  </tr>
  <tr align="center">
    <td><code>String.prototype</code></td>
    <td><code>Number.prototype</code></td>
    <td><code>Array.prototype</code></td>
    <td><code>Function.prototype</code></td>
  </tr>
</table>

## Object.create()
`Object.create()` `ES5` æ–¹æ³•å…è®¸ä½¿ç”¨æŒ‡å®šçš„åŸå‹å¯¹è±¡å’Œå±æ€§åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ã€‚
```javascript
// å¸¸äººçš„å±æ€§å’Œæ–¹æ³•/å¸¸äººåŸå‹
const personProto = {
 Â name: '',
  eat() { return 'åƒé¥­ ğŸš' },
 Â sleep() { return 'ç¡è§‰ ğŸ˜´' },
  sing() { return 'å”±æ­Œ ğŸ¤' },
  intro() { return `å¤§å®¶å¥½ï¼æˆ‘æ˜¯${this.name}ã€‚` }
};

// è®© personProto ä½œä¸º fan çš„åŸå‹
let fan = Object.create(personProto)
fan.name = 'å•ç²‰ä¸'
fan.height = 162
fan.gender = 'å¥³'
fan.travel = function() { return 'ç¯æ¸¸ä¸–ç•Œ ğŸŒğŸŒğŸŒ' }
```
æ˜¾ç„¶ï¼Œä»¥ä¸‹è¡¨è¾¾å¼éƒ½ä¼šè¿”å› `true`ã€‚
```javascript
> fan.__proto__ === personProto
â†’ true

> personProto.isPrototypeOf(fan)
â†’ true

> personProto === Object.getPrototypeOf(fan)
â†’ true 
```
å€¼å¾—æ³¨æ„çš„æ˜¯
```javascript
> Object.prototype.isPrototypeOf(fan)
â†’ true
```

é€šè¿‡ `Object.keys()` è·å– `fan` çš„æ‰€æœ‰å±æ€§åã€‚
```javascript
> Object.keys(fan)
â†’ ["name", "height", "gender", "travel"]
```

## Object.prototype.hasOwnProperty()
`Object.prototype.hasOwnProperty()` æ–¹æ³•ç”¨äºåˆ¤å®šæŸä¸ªæŒ‡å®šçš„å±æ€§æ˜¯å¦å¯¹è±¡çš„è‡ªèº«(éç»§æ‰¿)å±æ€§ã€‚
```javascript
> for (let key in fan) console.log(key, fan[key])
  name å•ç²‰ä¸
  height 162
  gender å¥³
  travel function () { return 'ç¯æ¸¸ä¸–ç•Œ ğŸŒğŸŒğŸŒ' }
  eat function eat() { return 'åƒé¥­ ğŸš' }
  sleep function sleep() { return 'ç¡è§‰ ğŸ˜´' }
  sing function sing() { return 'å”±æ­Œ ğŸ¤' }
  intro function intro() { return `å¤§å®¶å¥½ï¼æˆ‘æ˜¯${this.name}ã€‚` }
â†’ undefined
```
ç”±äº `for...in` ä¼šæŠŠç»§æ‰¿çš„å±æ€§å’Œæ–¹æ³•éƒ½è¿›è¡Œéå†ï¼Œå› æ­¤éœ€è¦ `Object.prototype.hasOwnProperty()`ã€‚
```javascript
> for (let key in fan) fan.hasOwnProperty(key) && console.log(key, fan[key])
  å•ç²‰ä¸
  height 162
  gender å¥³
 Â travel function () { return 'ç¯æ¸¸ä¸–ç•Œ ğŸŒğŸŒğŸŒ' }
â†’ false
```

## åŸå‹é“¾ Prototype Chain
åŸå‹æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤ä¹Ÿæœ‰ `__proto__` å±æ€§ï¼Œå³åŸå‹çš„åŸå‹ï¼Œè¿˜æœ‰åŸå‹çš„åŸå‹çš„åŸå‹ç­‰ã€‚è¿™å°±æ˜¯**åŸå‹é“¾**ã€‚  
`Object.prototype.__proto__` çš„å€¼æ˜¯ `null`ï¼Œè€Œ `null` æ²¡æœ‰åŸå‹ï¼Œåˆ°æ­¤å°±æ˜¯åŸå‹é“¾æœ«ç«¯ã€‚
```javascript
// åˆ›å»ºè‰ºäººçš„åŸå‹
const artistProto = Object.create(personProto)
artistProto.sing = function() { return 'å”±æ­Œ ğŸ¤ğŸ§ğŸ¸' }

// è®© artistProto ä½œä¸º jay çš„åŸå‹
let jay = Object.create(artistProto)
jay.name = 'å‘¨æ°ä¼¦'
jay.height = 175
jay.gender = 'ç”·'
jay.aiyo = function() { return 'å“å“Ÿï¼Œä¸é”™å“¦ï¼' }

// è®© artistProto ä½œä¸º kris çš„åŸå‹
let kris = Object.create(artistProto)
kris.name = 'å´äº¦å‡¡'
kris.height = 187
kris.intro = function() { return `æ­Œæ‰‹${this.name}ã€‚å…¶å®æˆ‘æ˜¯ä¸€ä¸ªæ¼”å‘˜ã€‚` }
kris['æœ‰ freestyle å—ï¼Ÿ'] = function() {
  return ['æœ‰ freestyle å—ï¼Ÿ', 'è¿˜æœ‰ freestyle å—ï¼Ÿ', 'æœ‰æ²¡æœ‰ freestyleï¼Ÿ'][Math.floor(Math.random() * 3)]
};
```
ğŸ¤” ä»¥ä¸‹ä»£ç ä¸­ `jay.intro()` å’Œ `kris.intro()` çš„ `intro()` æ–¹æ³•åˆ†åˆ«æ¥è‡ªå“ªé‡Œï¼Ÿ
```javascript
> jay.intro()
â†’ "å¤§å®¶å¥½ï¼æˆ‘æ˜¯å‘¨æ°ä¼¦ã€‚"

> kris.intro()
â†’ "æ­Œæ‰‹å´äº¦å‡¡ã€‚å…¶å®æˆ‘æ˜¯ä¸€ä¸ªæ¼”å‘˜ã€‚"
```
ğŸ’¡ åœ¨å¯¹è±¡åˆ›å»ºä¹‹åå¾€å…¶åŸå‹æ–°å¢å±æ€§/æ–¹æ³•ï¼Œå¯¹è±¡å¯ä»¥ç«‹å³è®¿é—®åˆ°ã€‚
```javascript
> jay.sing()
â†’ "å”±æ­Œ ğŸ¤ğŸ§ğŸ¸"

> artistProto.film = function() { return 'æ‹æˆ ğŸ¬ğŸ¬ğŸ¬' }
â†’ function () { return 'æ‹æˆ ğŸ¬ğŸ¬ğŸ¬' }

> jay.film()
â†’ "æ‹æˆ ğŸ¬ğŸ¬ğŸ¬"
```

## å‚è€ƒé“¾æ¥
* [JavaScriptæ·±å…¥ä¹‹ä»åŸå‹åˆ°åŸå‹é“¾](https://github.com/mqyqingfeng/Blog/blob/master/articles/%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E6%B7%B1%E5%85%A5%E4%B9%8B%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E5%8E%9F%E5%9E%8B%E9%93%BE.md)
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf
