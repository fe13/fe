# äº‹ä»¶ Event

ç½‘é¡µä¸­å¸¸è§çš„äº‹ä»¶æœ‰ç”¨æˆ·ç‚¹å‡»ï¼Œè¡¨å•æäº¤ç­‰ï¼ŒåŒæ—¶ä½ è¿˜å¯ä»¥è‡ªå®šä¹‰äº‹ä»¶å¦‚æ–°å»ºè®¢å•ï¼Œæ‘‡ä¸€æ‘‡ã€‚äº‹ä»¶çš„æ¦‚å¿µå¹¶ä¸é™äº JavaScriptï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰äº‹ä»¶æ¨¡å‹ã€‚

## å¸¸è§äº‹ä»¶
| äº‹ä»¶                                               | è§£é‡Š                |
|---------------------------------------------------|---------------------|
| `click` `dblclick`                                | é¼ æ ‡ ğŸ–± å•å‡»/åŒå‡»     |
| `mouseenter` `mousemove` `mouseleave`             | é¼ æ ‡ ğŸ–± è¿›å…¥/ç§»åŠ¨/ç¦»å¼€ |
| `submit` `reset`                                  | è¡¨å•æäº¤/é‡ç½®         |
| `keydown` `keyup`                                 | é”®ç›˜é”®æŒ‰ä¸‹/æ¾å¼€       |
| `touchstart` `touchmove` `touchend` `touchcancel` | è§¦æ§äº‹ä»¶             |
| `transitionstart` `transitionrun` `transitionend` | CSS è¿‡æ¸¡åŠ¨ç”»äº‹ä»¶      |
| `DOMContentLoaded` Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   | DOM æ ‘ ğŸŒ² æ„å»ºå®Œæˆäº‹ä»¶ |
| `load` Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   | ç½‘é¡µå›¾ç‰‡ç­‰åŠ è½½å®Œæˆäº‹ä»¶  |

ğŸ’¡ è¿˜æœ‰å¾ˆå¤šå…¶ä»– DOM äº‹ä»¶å’Œé DOMÂ äº‹ä»¶ï¼Œè¯·å‚é˜… [MDN äº‹ä»¶åˆ—è¡¨](https://developer.mozilla.org/en-US/docs/Web/Events)ã€‚

## å“åº”äº‹ä»¶
### HTML å±æ€§
é€šè¿‡å…ƒç´ çš„ `on<event>`(å¦‚ `onclick`)å±æ€§å“åº”äº‹ä»¶ã€‚
```html
<button onclick="alert('æ¸…é™¤æˆåŠŸ!')">æ¸…é™¤ç¼“å­˜</button>
```
```html
<script>
  function clearCache() { alert('æ¸…é™¤æˆåŠŸ!'); }
</script>

<button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
```
### DOM å±æ€§
```javascript
window.onload = function() {
 Â console.log('æ‰€æœ‰å¤–éƒ¨èµ„æºåŠ è½½å®Œæˆï¼Œå‡†å¤‡å‘å°„ ğŸš€');
};
```
ç§»é™¤é€šè¿‡ DOM å±æ€§æ·»åŠ çš„äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚
```javascript
window.onload = null;
```
ğŸ’¡ ä»¥ä¸Šä¸¤ç§å“åº”äº‹ä»¶çš„æ–¹å¼ä»…é€‚åˆç®€å•é¡µé¢ï¼Œå› ä¸º `on<event>` å±æ€§å¦‚ `onclick` ä»…æœ‰ä¸€ä¸ªã€‚

### æ ‡å‡†æ–¹æ³•
#### addEventListener
`EventTarget.prototype.addEventListener()` æ˜¯æ·»åŠ äº‹ä»¶ç›‘å¬å™¨çš„æ ‡å‡†æ–¹æ³•ï¼Œå¯ç»™åŒä¸€äº‹ä»¶æ·»åŠ å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚
```javascript
// ä½¿ç”¨åŒ¿åå‡½æ•°ä½œä¸ºäº‹ä»¶ç›‘å¬å™¨
window.addEventListener('resize', function() {
  console.log('window.innerWidth', window.innerWidth, 'window.innerHeight', window.innerHeight);
});

function logDocumentClientSize() {
  let width = document.documentElement.clientWidth;
  let height = document.documentElement.clientHeight;
  console.log('documentElement.clientWidth', width, 'documentElement.clientHeight', height);
}

// ä½¿ç”¨å…·åå‡½æ•°ä½œä¸ºäº‹ä»¶ç›‘å¬å™¨
window.addEventListener('resize', logDocumentClientSize);
```

#### removeEventListener
`EventTarget.prototype.removeEventListener()` æ–¹æ³•ç”¨äºç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚
```javascript
// ç§»é™¤äº‹ä»¶ç›‘å¬å™¨å¿…é¡»ç»™å®šå‡½æ•°å
window.removeEventListener('resize', logDocumentClientSize);
```
âš ï¸ ä»¥ä¸‹ä»£ç **ä¸èƒ½**è¾¾åˆ°ç§»é™¤äº‹ä»¶ç›‘å¬å™¨çš„ç›®çš„ã€‚
```javascript
window.removeEventListener('resize', function() {
  console.log('window.innerWidth', window.innerWidth, 'window.innerHeight', window.innerHeight);
});
```
#### handleEvent æ–¹æ³•
é™¤äº†å¯ä»¥ç»™ `addEventListener` ä¼ é€’ä¸€ä¸ªå‡½æ•°ä½œä¸ºäº‹ä»¶ç›‘å¬å™¨ï¼Œè¿˜å¯ä»¥ä¼ é€’ä¸€ä¸ªåŒ…å« `handleEvent` æ–¹æ³•çš„å¯¹è±¡ã€‚
```javascript
var handler = {
  handleEvent(event) {
    switch (event.type) {
      case 'mousedown':
 Â  Â  Â  Â console.log('mousedown', event.clientX, event.clientY);
        break;
      case 'mousemove':
        console.log('mousemove', event.clientX, event.clientY);
        break;
    }
  }
};

document.addEventListener('mousedown', handler);
document.addEventListener('mousemove', handler);
```


## äº‹ä»¶å¯¹è±¡
å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæµè§ˆå™¨ä¼šæ–°å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡(åŒ…å«è¯¥äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯)ï¼Œå¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨å‡½æ•°ã€‚
```javascript
document.addEventListener('click', function(event) {
 Â console.log('äº‹ä»¶å¯¹è±¡', event);
 Â console.log('äº‹ä»¶ç±»å‹', event.type);
 Â console.log('è§¦å‘äº‹ä»¶çš„å…ƒç´ ', event.target);
 Â console.log('ç›‘å¬äº‹ä»¶çš„å…ƒç´ ', event.currentTarget);
 Â console.log('äº‹ä»¶å‘ç”Ÿçš„åæ ‡', event.clientX, event.clientY, '(ä»¥çª—å£å·¦ä¸Šè§’ä¸ºåŸç‚¹)');
  
  console.log('this', this);
  console.log('this === event.currentTarget', this === event.currentTarget);    // true
});
```
ğŸ’¡ äº‹ä»¶å¯¹è±¡çš„åå­—è‡ªå®šï¼Œå¸¸è§çš„æœ‰ `e` `evt` `event`ã€‚

ğŸ¤” `event.target` å’Œ `event.currentTarget` çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

## äº‹ä»¶ä¼ æ’­ Event Propagation
æ ‡å‡† [DOM äº‹ä»¶](https://www.w3.org/TR/DOM-Level-3-Events/) çš„ä¼ æ’­åˆ†æˆä¸‰ä¸ªé˜¶æ®µã€‚
1. æ•è·é˜¶æ®µ - äº‹ä»¶å¾€ä¸‹ä¼ æ’­è‡³å…ƒç´ 
2. ç›®æ ‡é˜¶æ®µ - äº‹ä»¶æŠµè¾¾ç›®æ ‡å…ƒç´ 
3. å†’æ³¡é˜¶æ®µ - äº‹ä»¶ä»å…ƒç´ å‘ä¸Šä¼ æ’­

### æ•è·é˜¶æ®µ Capturing Phase
æ•è·(ä¸ºä»€ä¹ˆä¸æ˜¯æ½œæ°´ï¼Ÿæ½œæ°´å’Œå†’æ³¡æ‰æ˜¯ä¸€å¯¹ ğŸ¤”)é˜¶æ®µ

### å†’æ³¡é˜¶æ®µ Bubbling Phase

### åœæ­¢ä¼ æ’­
`event.stopPropagation()`

## é»˜è®¤è¡Œä¸º
`event.preventDefault()`

## äº‹ä»¶å§”æ‰˜ Event Delegation

## äº‹ä»¶åˆ†æ´¾ Event Dispatch

## å‚è€ƒé“¾æ¥
* https://davidwalsh.name/event-delegate
* https://javascript.info/dispatch-events
* https://developer.mozilla.org/en-US/docs/Web/Events
* https://webkit.org/blog/5610/more-responsive-tapping-on-ios
* https://developer.mozilla.org/en-US/docs/Web/API/Event/currentTarget
* https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState
* https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector
* https://developers.google.com/web/updates/2013/12/300ms-tap-delay-gone-away
* https://developers.google.com/web/updates/2016/06/passive-event-listeners
* https://github.com/WICG/EventListenerOptions
* https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md
* https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener
* https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener
* https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events

