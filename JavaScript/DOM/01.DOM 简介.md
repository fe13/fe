# DOM ç®€ä»‹

DOM å…¨ç§° Document Object Modelï¼Œå³æ–‡æ¡£(çš„)å¯¹è±¡æ¨¡å‹ã€‚JavaScript æ˜¯å…¶ä¸­ä¸€ç§å¯ç”¨äºæ“ä½œ DOM çš„ç¼–ç¨‹è¯­è¨€ã€‚

DOM è§„èŒƒ
* W3C https://www.w3.org/TR/dom
* WhatWG https://dom.spec.whatwg.org

## DOM æ ‘ ğŸŒ²
æ‰“å¼€ Chrome å¼€å‘å·¥å…·
* `Win` F12
* `Mac` Command + Option + I

é€‰æ‹© **Elements** æ ‡ç­¾ï¼ŒDOM æ ‘å°±åœ¨çœ¼å‰ã€‚ğŸ’¡ åœ¨ Chrome Console ä¸­ï¼Œ`$0` ä»£è¡¨å½“å‰é€‰ä¸­çš„å…ƒç´ ã€‚

### DOM èŠ‚ç‚¹
DOM æ ‘ç”±èŠ‚ç‚¹(Node)æ„æˆï¼Œä¸€å…±æœ‰ 12 ç§èŠ‚ç‚¹ https://dom.spec.whatwg.org/#node ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ã€‚
* æ–‡æ¡£èŠ‚ç‚¹ `document`
* å…ƒç´ èŠ‚ç‚¹ Element Node
* æ–‡æœ¬èŠ‚ç‚¹ Text Node
* æ³¨é‡ŠèŠ‚ç‚¹ Comment Node

## document å¯¹è±¡
`document` å¯¹è±¡ä»£è¡¨æ•´ä¸ªæ–‡æ¡£ï¼Œå³ DOM æ ‘ã€‚
```javascript
> document
â†’ â–¶ï¸ #document

> document.doctype Â  Â  Â  Â  Â   // æ–‡æ¡£ç±»å‹
â†’ Â  <!DOCTYPE html> Â  Â  Â  Â  Â  // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.head               // <head>
â†’ â–¶ï¸ <head>â€¦</head>            // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.body               // <body>
â†’ â–¶ï¸ <body>â€¦</body> Â  Â  Â       // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.documentElement Â   // <html>
â†’ â–¶ï¸ <html>â€¦</html> Â  Â         // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.documentElement.clientWidth     // æ–‡æ¡£å®½åº¦(ä¸åŒ…å«æ»šåŠ¨æ¡)
â†’ 1265 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â                // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š 

> document.documentElement.clientHeight Â   // æ–‡æ¡£é«˜åº¦(ä¸åŒ…å«æ»šåŠ¨æ¡)
â†’ 640                                      // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.body.style.background = '#CDF5DC'
â†’ "#CDF5DC"
```

`document.getElementById()` æ–¹æ³•ç”¨äºè·å–ç‰¹å®š `id` çš„å…ƒç´ ã€‚
```html
<main id="content"></main>
```
```javascript
> document.getElementById('content')
â†’ â–¶ï¸ <main id="content">â€¦</main>

> window.content
â†’ â–¶ï¸ <main id="content">â€¦</main>
```

## æŸ¥æ‰¾å…ƒç´ 
`element.getElementsByTagName()` æ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ ‡ç­¾åçš„**åŠ¨æ€**å…ƒç´ é›†åˆã€‚ğŸ’¡ ä¸è¦æ¼äº† `s`ã€‚
```javascript
let elements = document.getElementsByTagName('*'); Â  // è·å–æ‰€æœ‰å…ƒç´ 

elements[0] Â  Â  Â  Â  Â  Â  Â  Â  Â  Â                       // ç¬¬ä¸€ä¸ªå…ƒç´ 
elements[elements.length - 1] Â                       // æœ€åä¸€ä¸ªå…ƒç´ 
elements.constructor Â  Â  Â  Â  Â                        // function HTMLCollection() { [native code] }

let content = document.getElementById('content'); Â   // å‡è®¾æœ‰ id="content" çš„å…ƒç´ 
let ps = content.getElementsByTagName('p'); Â  Â  Â  Â   // content å†…çš„æ‰€æœ‰ <p>
```

`element.getElementsByClassName()` æ–¹æ³•ç”¨äºè·å–æŒ‡å®šç±»åçš„**åŠ¨æ€**å…ƒç´ é›†åˆã€‚å¤šä¸ªç±»åä»¥ç©ºæ ¼éš”å¼€ã€‚
```javascript
let players = document.getElementsByClassName('player');

players.constructor Â  Â  Â  Â  Â                         // function HTMLCollection() { [native code] }

let gsw = document.getElementById('gsw'); Â           // å‡è®¾æœ‰ id="gsw" çš„å…ƒç´ 
let warriors = gsw.getElementsByClassName('player warrior');
```

`element.querySelector()` æ–¹æ³•ç”¨äºè·å–åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ ã€‚æ²¡æœ‰åˆ™è¿”å› `null`ã€‚
```javascript
document.querySelector('.product.featured')
```

`element.querySelectorAll()` æ–¹æ³•ç”¨äºè·å–åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„**é™æ€**å…ƒç´ é›†åˆã€‚æ²¡æœ‰åˆ™è¿”å› `[]`ã€‚
```javascript
let warriors = document.querySelectorAll('.warriors .warrior')

warriors.constructor    // function NodeList() { [native code] }
```
ğŸ’¡ `ES6` æ–°å¢çš„ `for..of` å¯ç”¨äºéå† `HTMLCollection` å’Œ `NodeList`ã€‚
```javascript
for (let warrior of document.querySelectorAll('.warrior')) console.log(warrior)
```
ğŸ’¡ é€šè¿‡ `Array.from()` å°†é›†åˆè½¬æˆæ•°ç»„ã€‚
```javascript
Array.from(document.body.childNodes)
```

## èŠ‚ç‚¹å…³ç³»
* `node.childNodes` `elem.children`

* `node.firstChild` `elem.firstElementChild`

* `node.lastChild` `elem.lastElementChild`

* `node.parentNode` `elem.parentElement`

* `node.nextSibling` `elem.nextElementSibling`

* `node.previousSibling` `elem.previousElementSibling`

## èŠ‚ç‚¹å±æ€§
* `node.nodeType` èŠ‚ç‚¹ç±»å‹ - `1` ä»£è¡¨å…ƒç´ èŠ‚ç‚¹ï¼Œ`3` ä»£è¡¨æ–‡æœ¬èŠ‚ç‚¹ï¼Œ`9` ä»£è¡¨ `document`

* `node.nodeName` èŠ‚ç‚¹åç§° - `BODY` `DIV` `#text` `#comment` `#document` ç­‰

* `node.nodeValue` `node.data` è·å–/è®¾ç½®èŠ‚ç‚¹æ–‡æœ¬å†…å®¹

* `node.innerText` `node.textContent` è·å–/è®¾ç½®èŠ‚ç‚¹åŠå…¶åä»£çš„æ–‡æœ¬å†…å®¹

* `elem.tagName ` æ ‡ç­¾åç§° - åªæœ‰å…ƒç´ èŠ‚ç‚¹æ‰å…·æœ‰è¯¥å±æ€§

* `elem.innerHTML` ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–/**è®¾ç½®**å…ƒç´ å†…éƒ¨ HTML

* `elem.outerHTML` ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–/**æ›¿æ¢**å…ƒç´ æ•´ä½“ HTML

**HTML å±æ€§**
* `id`
* `href`
* `value`
* `hidden`
* `data-*` ğŸŒ° `data-price` å±æ€§çš„å€¼å¯é€šè¿‡Â `elem.dataset.price` è·å–ã€‚
* ...

### å±æ€§æ–¹æ³•
* `elem.hasAttribute(name)` - æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§

* `elem.getAttribute(name)` â€“ è·å–å±æ€§å€¼

* `elem.setAttribute(name, value)` â€“ è®¾ç½®å±æ€§å€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œå¦‚ `document.body.id = 'main';`

* `elem.removeAttribute(name)` - ç§»é™¤å±æ€§

## EventTarget
`EventTarget.prototype.addEventListener()`

`EventTarget.prototype.removeEventListener()`

`EventTarget.prototyoe.dispatchEvent()`

## ç»§æ‰¿å…³ç³»
é€šè¿‡æ·»åŠ ä»¥ä¸‹ `Object.prototype.ctors()` æ–¹æ³•æŸ¥çœ‹æŸä¸ªèŠ‚ç‚¹å¯¹è±¡(æˆ–ä»»æ„å¯¹è±¡)çš„ç»§æ‰¿å…³ç³»ã€‚ 
```javascript
Object.prototype.ctors = function(log = false) {
 Â let ctors = [];
  let proto = Object.getPrototypeOf(this);
  while (proto) {
    ctors.push(proto.constructor);
    proto = Object.getPrototypeOf(proto);
  }
  if (log) ctors.forEach(ctor => console.log(ctor));
  return ctors;
};
```
```javascript
> document.body.ctors(true)
  function HTMLBodyElement() { [native code] }
  function HTMLElement() { [native code] }
  function Element() { [native code] }
  function Node() { [native code] }
  function EventTarget() { [native code] }
 Â function Object() { [native code] }
â†’ â–¶ï¸ (6) [function, function, function, function, function, function]
```
å¯ä»¥é€šè¿‡ `instanceof` éªŒè¯ç»§æ‰¿å…³ç³»ã€‚
```javascript
> document.body instanceof HTMLBodyElement
â†’ true

> document.body instanceof EventTarget
â†’ true

> document instanceof Element
â†’ false

> document instanceof Node
â†’ true

> document instanceof EventTarget
â†’ true
```

## CSSOM
CSSOM å…¨ç§° CSS Object Modelï¼Œå³ CSS å¯¹è±¡æ¨¡å‹ã€‚https://www.w3.org/TR/cssom-1

## å‚è€ƒé“¾æ¥
* https://css-tricks.com/dom
* https://javascript.info/browser-environment
* https://en.wikipedia.org/wiki/Document_Object_Model
* https://developer.mozilla.org/en-US/docs/Web/API/document
* https://developer.mozilla.org/en-US/docs/Web/API/Node
* https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType
* https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName
* https://developer.mozilla.org/en-US/docs/Web/API/Element
* https://developer.mozilla.org/en-US/docs/Web/API/Element/getElementsByTagName
* https://developer.mozilla.org/en-US/docs/Web/API/Element/matches
* https://developer.mozilla.org/en-US/docs/Web/API/EventTarget
* https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById
* https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByTagName
* https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement
* https://developer.mozilla.org/en-US/docs/Web/API/Document/documentElement
* https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction
* https://stackoverflow.com/questions/15763358/difference-between-htmlcollection-nodelists-and-arrays-of-objects
