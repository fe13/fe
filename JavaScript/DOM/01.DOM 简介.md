# DOM ç®€ä»‹

DOM å…¨ç§° Document Object Modelï¼Œå³æ–‡æ¡£(çš„)å¯¹è±¡æ¨¡å‹ã€‚JavaScript æ˜¯å…¶ä¸­ä¸€ç§å¯ç”¨äºæ“ä½œ DOM çš„ç¼–ç¨‹è¯­è¨€ã€‚

DOM è§„èŒƒ
* W3C https://www.w3.org/TR/dom
* WhatWG https://dom.spec.whatwg.org

## DOM æ ‘ ğŸŒ²
æ‰“å¼€ Chrome å¼€å‘å·¥å…·
* `Win` F12
* `Mac` Command + Option + I

é€‰æ‹© **Elements** æ ‡ç­¾ï¼ŒDOM æ ‘å°±åœ¨çœ¼å‰ã€‚ğŸ’¡ åœ¨ Chrome Console ä¸­ï¼Œ`$0` ä»£è¡¨å½“å‰é€‰ä¸­çš„å…ƒç´ ã€‚

### DOM èŠ‚ç‚¹
DOM æ ‘ç”±èŠ‚ç‚¹(Node)æ„æˆï¼Œä¸€å…±æœ‰ 12 ç§èŠ‚ç‚¹ https://dom.spec.whatwg.org/#node ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ã€‚
* æ–‡æ¡£èŠ‚ç‚¹ `document`
* å…ƒç´ èŠ‚ç‚¹ Element Node
* æ–‡æœ¬èŠ‚ç‚¹ Text Node
* æ³¨é‡ŠèŠ‚ç‚¹ Comment Node

## document å¯¹è±¡
`document` å¯¹è±¡ä»£è¡¨æ•´ä¸ªæ–‡æ¡£ï¼Œå³ DOM æ ‘ã€‚
```javascript
> document
â†’ â–¶ï¸ #document

> document.doctype Â  Â  Â  Â  Â   // æ–‡æ¡£ç±»å‹
â†’ Â  <!DOCTYPE html> Â  Â  Â  Â  Â  // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.head               // <head>
â†’ â–¶ï¸ <head>â€¦</head>            // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.body               // <body>
â†’ â–¶ï¸ <body>â€¦</body> Â  Â  Â       // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.documentElement Â   // <html>
â†’ â–¶ï¸ <html>â€¦</html> Â  Â         // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.documentElement.clientWidth     // æ–‡æ¡£å®½åº¦(ä¸åŒ…å«æ»šåŠ¨æ¡)
â†’ 1265 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â                // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š 

> document.documentElement.clientHeight Â   // æ–‡æ¡£é«˜åº¦(ä¸åŒ…å«æ»šåŠ¨æ¡)
â†’ 640                                      // è¿”å›ç»“æœç”±å®é™…æƒ…å†µå†³å®š

> document.body.style.background = '#CDF5DC'
â†’ "#CDF5DC"
```

`document.getElementById()` æ–¹æ³•ç”¨äºè·å–ç‰¹å®š `id` çš„å…ƒç´ ã€‚
```html
<main id="content"></main>
```
```javascript
> document.getElementById('content')
â†’ â–¶ï¸ <main id="content">â€¦</main>

> window.content
â†’ â–¶ï¸ <main id="content">â€¦</main>
```

## æŸ¥æ‰¾å…ƒç´ 
`element.getElementsByTagName()` æ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ ‡ç­¾åçš„**åŠ¨æ€**å…ƒç´ é›†åˆã€‚ğŸ’¡ ä¸è¦æ¼äº† `s`ã€‚
```javascript
let elements = document.getElementsByTagName('*'); Â  // è·å–æ‰€æœ‰å…ƒç´ 

elements[0] Â  Â  Â  Â  Â  Â  Â  Â  Â  Â                       // ç¬¬ä¸€ä¸ªå…ƒç´ 
elements[elements.length - 1] Â                       // æœ€åä¸€ä¸ªå…ƒç´ 
elements.constructor Â  Â  Â  Â  Â                        // function HTMLCollection() { [native code] }

let content = document.getElementById('content'); Â   // å‡è®¾æœ‰ id="content" çš„å…ƒç´ 
let ps = content.getElementsByTagName('p'); Â  Â  Â  Â   // content å†…çš„æ‰€æœ‰ <p>
```

`element.getElementsByClassName()` æ–¹æ³•ç”¨äºè·å–æŒ‡å®šç±»åçš„**åŠ¨æ€**å…ƒç´ é›†åˆã€‚å¤šä¸ªç±»åä»¥ç©ºæ ¼éš”å¼€ã€‚
```javascript
let players = document.getElementsByClassName('player');

players.constructor Â  Â  Â  Â  Â                         // function HTMLCollection() { [native code] }

let gsw = document.getElementById('gsw'); Â           // å‡è®¾æœ‰ id="gsw" çš„å…ƒç´ 
let warriors = gsw.getElementsByClassName('player warrior');
```

`element.querySelector()` æ–¹æ³•ç”¨äºè·å–åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„**ç¬¬ä¸€ä¸ª**å…ƒç´ ã€‚æ²¡æœ‰åˆ™è¿”å› `null`ã€‚
```javascript
document.querySelector('.product.featured')
```

`element.querySelectorAll()` æ–¹æ³•ç”¨äºè·å–åŒ¹é…æŒ‡å®šé€‰æ‹©å™¨çš„**é™æ€**å…ƒç´ é›†åˆã€‚æ²¡æœ‰åˆ™è¿”å› `[]`ã€‚
```javascript
let warriors = document.querySelectorAll('.warriors .warrior')

warriors.constructor    // function NodeList() { [native code] }
```
ğŸ’¡ `ES6` æ–°å¢çš„ `for..of` å¯ç”¨äºéå† `HTMLCollection` å’Œ `NodeList`ã€‚
```javascript
for (let warrior of document.querySelectorAll('.warrior')) console.log(warrior)
```
ğŸ’¡ é€šè¿‡ `Array.from()` å¯ä»¥å°†é›†åˆè½¬æˆæ•°ç»„ã€‚
```javascript
Array.from(document.body.childNodes)
```

## èŠ‚ç‚¹å…³ç³»
* `node.childNodes` `elem.children`

* `node.firstChild` `elem.firstElementChild`

* `node.lastChild` `elem.lastElementChild`

* `node.parentNode` `elem.parentElement`

* `node.nextSibling` `elem.nextElementSibling`

* `node.previousSibling` `elem.previousElementSibling`

## èŠ‚ç‚¹å±æ€§
* `node.nodeType` èŠ‚ç‚¹ç±»å‹ - `1` ä»£è¡¨å…ƒç´ èŠ‚ç‚¹ï¼Œ`3` ä»£è¡¨æ–‡æœ¬èŠ‚ç‚¹ï¼Œ`9` ä»£è¡¨ `document`

* `node.nodeName` èŠ‚ç‚¹åç§° - `BODY` `DIV` `#text` `#comment` `#document` ç­‰

* `node.nodeValue` `node.data` è·å–/è®¾ç½®èŠ‚ç‚¹æ–‡æœ¬å†…å®¹

* `node.innerText` `node.textContent` è·å–/è®¾ç½®èŠ‚ç‚¹åŠå…¶åä»£çš„æ–‡æœ¬å†…å®¹

* `elem.tagName ` æ ‡ç­¾åç§° - åªæœ‰å…ƒç´ èŠ‚ç‚¹æ‰å…·æœ‰è¯¥å±æ€§

* `elem.innerHTML` ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–/**è®¾ç½®**å…ƒç´ å†…éƒ¨ HTML

* `elem.outerHTML` ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–/**æ›¿æ¢**å…ƒç´ æ•´ä½“ HTML

### HTML å±æ€§
HTML å±æ€§ä¸€èˆ¬å¯é€šè¿‡ `.` è®¿é—®å’Œè®¾ç½®ã€‚
* `id`
* `href`
* `value`
* `hidden`
* `data-*` ğŸŒ° `data-price` å±æ€§çš„å€¼å¯é€šè¿‡Â `elem.dataset.price` è·å–ã€‚
* ...

### å±æ€§æ–¹æ³•
* `elem.hasAttribute(name)` - æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§

* `elem.getAttribute(name)` â€“ è·å–å±æ€§å€¼

* `elem.setAttribute(name, value)` â€“ è®¾ç½®å±æ€§å€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œå¦‚ `document.body.id = 'main';`

* `elem.removeAttribute(name)` - ç§»é™¤å±æ€§

## å…ƒç´ æ ·å¼
* `elem.style.*` è·å–/è®¾ç½®è¡Œå†…æ ·å¼ `document.body.background = '#CDF5DC'`;

* `elem.className` è·å–/è®¾ç½® `class` å±æ€§

* `elem.classList.add()` æ·»åŠ  CSS ç±» `el.classList.add('active')` `el.classList.add('product', 'discount')`
* `elem.classList.remove()` ç§»é™¤ CSS ç±» `el.classList.remove('player', 'active')`
* `elem.classList.toggle()` åˆ‡æ¢ CSS ç±» `el.classList.toggle('active', navigator.onLine)`
* `elem.classList.contains()` æ˜¯å¦åŒ…å«ä¸€ä¸ª/å¤šä¸ª CSS ç±» `el.classList.contains('active')`

* `window.getComputedStyle()` è·å–å…ƒç´ ç»è¿‡è®¡ç®—çš„æ‰€æœ‰å±æ€§å€¼ `getComputedStyle(document.body)`

## ä¿®æ”¹æ–‡æ¡£
* `document.write()` åœ¨æ–‡æ¡£**åŠ è½½**æœŸé—´å®æ—¶å†™å…¥ HTMLã€‚âš ï¸ åœ¨æ–‡æ¡£åŠ è½½åè°ƒç”¨ä¼šæŠ¹å»æ–‡æ¡£å†…å®¹ã€‚

* `document.createElement()` åˆ›å»ºå…ƒç´ èŠ‚ç‚¹ `document.createElement('a')`

* `document.createTextNode()` åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹

* `parent.appendChild(node)` å°† `node` æ·»åŠ åˆ° `parent` ç»“å°¾
* `parent.insertBefore(node, next)` åœ¨Â `parent` é‡Œçš„ `next` å‰æ’å…¥ `node`
* `parent.replaceChild(node, child)` å°† `parent` é‡Œçš„ `child` æ›¿æ¢æˆ `node`
* `parent.removeChild(node)` å°† `parent` é‡Œçš„ `node` ç§»é™¤
* `node.cloneNode(deep)` å…‹éš†èŠ‚ç‚¹ - å½“ `deep` ä¸º `true` æ—¶ï¼Œè¿å±æ€§å’Œå­å…ƒç´ ä¸€èµ·å…‹éš†ã€‚

* `elem.append(èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²)`
* `elem.prepend(èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²)`
* `elem.before(èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²)`
* `elem.after(èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²)`
* `elem.replaceWith(èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²)`
* `elem.remove()`

* `elem.insertAdjacentHTML(where, html)` å°† `html` æ’å…¥åˆ°Â `where` æŒ‡å®šçš„ä½ç½®  
    * `where` - `beforebegin` `afterbegin` `beforeend` `afterend`
* `elem.insertAdjacentText()`
* `elem.insertAdjacentElement()`

ğŸŒ° **è¿”å›é¡¶éƒ¨é“¾æ¥**
```javascript
var a = document.createElement('a');
a.href = '#';
a.innerText = 'è¿”å›é¡¶éƒ¨';
a.style.right = '10px';
a.style.bottom = '20px';
a.style.position = 'fixed';
document.body.appendChild(a);
```

## åæ ‡ä½ç½®
`elem.getBoundingClientRect()` è¿”å›å…ƒç´ å„è¾¹ç•Œç›¸å¯¹çª—å£å·¦ä¸Šè§’çš„åæ ‡ã€‚
```javascript
æ–‡æ¡£åæ ‡ X = çª—å£åæ ‡ X + pageXOffset;
æ–‡æ¡£åæ ‡ Y = çª—å£åæ ‡ Y + pageYOffset;
```
`document.elementFromPoint(x, y)` è¿”å›ä½äºæŒ‡å®šçª—å£åæ ‡çš„å…ƒç´ ã€‚
```javascript
// ç»™ä½äºçª—å£æ­£ä¸­é—´çš„å…ƒç´ æ·»åŠ è“è‰²èƒŒæ™¯
(function() {
   let x = document.documentElement.clientWidth / 2;
   let y = document.documentElement.clientHeight / 2;
   document.elementFromPoint(x, y).style.background = '#27C0F2';
})();
```

## äº‹ä»¶å¤„ç†
`EventTarget.prototype.addEventListener()` æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
```javascript
document.body.addEventListener('click', function(event) {
  let target = event.target;
  target.style.transition = '.5s';
  target.style.transform = target.style.transform === 'rotate(180deg)' ? 'rotate(0)' : 'rotate(180deg)';
});
```

`EventTarget.prototype.removeEventListener()` ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
```javascript
function onClickBody(event) {
  let target = event.target;
  target.style.transition = '.5s';
  target.style.transform = target.style.transform === 'rotate(180deg)' ? 'rotate(0)' : 'rotate(180deg)';
}

document.body.addEventListener('click', onClickBody);
document.body.removeEventListener('click', onClickBody);
```

`EventTarget.prototyoe.dispatchEvent()` åˆ†æ´¾/è§¦å‘äº‹ä»¶

## ç»§æ‰¿å…³ç³»
é€šè¿‡æ·»åŠ ä»¥ä¸‹ `Node.prototype.ctors()` æ–¹æ³•æŸ¥çœ‹ç‰¹å®šèŠ‚ç‚¹å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ã€‚ 
```javascript
Node.prototype.ctors = function(log = false) {
 Â let ctors = [];
  let proto = Object.getPrototypeOf(this);
  while (proto) {
    ctors.push(proto.constructor);
    proto = Object.getPrototypeOf(proto);
  }
  if (log) ctors.forEach(ctor => console.log(ctor));
  return ctors;
};
```
```javascript
> document.body.ctors(true)
  function HTMLBodyElement() { [native code] }
  function HTMLElement() { [native code] }
  function Element() { [native code] }
  function Node() { [native code] }
  function EventTarget() { [native code] }
 Â function Object() { [native code] }
â†’ â–¶ï¸ (6) [function, function, function, function, function, function]
```
å¯ä»¥é€šè¿‡ `instanceof` éªŒè¯ç»§æ‰¿å…³ç³»ã€‚
```javascript
> document.body instanceof HTMLBodyElement
â†’ true

> document.body instanceof EventTarget
â†’ true

> document instanceof Element
â†’ false

> document instanceof Node
â†’ true

> document instanceof EventTarget
â†’ true
```

## CSSOM
CSSOM å…¨ç§° CSS Object Modelï¼Œå³ CSS å¯¹è±¡æ¨¡å‹ã€‚https://www.w3.org/TR/cssom-1

## å‚è€ƒé“¾æ¥
* https://css-tricks.com/dom
* https://javascript.info/coordinates
* https://javascript.info/browser-environment
* https://en.wikipedia.org/wiki/Document_Object_Model
* https://developer.mozilla.org/en-US/docs/Web/API/document
* https://developer.mozilla.org/en-US/docs/Web/API/Node
* https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType
* https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName
* https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollX
* https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollY
* https://developer.mozilla.org/en-US/docs/Web/API/Element
* https://developer.mozilla.org/en-US/docs/Web/API/Element/getElementsByTagName
* https://developer.mozilla.org/en-US/docs/Web/API/Element/matches
* https://developer.mozilla.org/en-US/docs/Web/API/EventTarget
* https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent
* https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById
* https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByTagName
* https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement
* https://developer.mozilla.org/en-US/docs/Web/API/Document/documentElement
* https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction
* https://stackoverflow.com/questions/15763358/difference-between-htmlcollection-nodelists-and-arrays-of-objects
