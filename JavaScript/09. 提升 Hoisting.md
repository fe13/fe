# æå‡ Hoisting

JavaScript ä¸­çš„æå‡(Hoisting)ç‰¹æŒ‡ä½¿ç”¨ `var` å£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜è¢«æå‡åˆ°æ‰€åœ¨ä½œç”¨åŸŸçš„é¡¶ç«¯ã€‚

## å˜é‡æå‡
ä½¿ç”¨ `var` å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°æ‰€åœ¨ä½œç”¨åŸŸçš„é¡¶ç«¯ï¼Œå› æ­¤ä»¥ä¸‹å‡½æ•° `met()`
```javascript
function met() {
  lyrics = 'å¬è§ å†¬å¤©çš„ç¦»å¼€';
 
  console.log(lyrics);
 
 Â var lyrics;  // lyrics è¢«æå‡åˆ°ä½œç”¨åŸŸé¡¶ç«¯
}
```
ç­‰åŒäº
```javascript
function met() {
  var lyrics;
  
  lyrics = 'å¬è§ å†¬å¤©çš„ç¦»å¼€';
 
  console.log(lyrics);
}
```
ğŸ’¡ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**è¢«æå‡çš„æ˜¯å£°æ˜ï¼Œè€Œä¸æ˜¯èµ‹å€¼**ã€‚å› æ­¤ä»¥ä¸‹å‡½æ•° `nodiff()`
```javascript
function nodiff() {
  console.log(lyrics);  // è¾“å‡º undefined
  
  var lyrics = 'å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆä¸åŒ';
}
```
ç­‰åŒäº
```javascript
function nodiff() {
 Â var lyrics;  // æœªèµ‹å€¼çš„å˜é‡å€¼æ˜¯ undefined
 Â 
 Â console.log(lyrics);  // è¾“å‡º undefined
 Â 
  lyrics = 'å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆä¸åŒ';
}
```

âš ï¸ `let` **ä¸å­˜åœ¨**å˜é‡æå‡ã€‚ä»¥ä¸‹ä¾‹å­**ä¸èƒ½**è¯´æ˜ `let` è¢«æå‡ã€‚
```javascript
// å‡è®¾ `let` è¢«æå‡ï¼Œåˆ™ `console.log(apple)` åº”è¯¥è¾“å‡º `undefined` è€Œä¸æ˜¯æŠ¥é”™ã€‚

var apple = 'ğŸ';
{
 Â console.log(apple);  // æŠ¥é”™ Uncaught ReferenceError: apple is not defined
 Â let apple = 'ğŸ';
}
```
`{}` ä¸­çš„ `apple` å£°æ˜å±è”½äº†å¤–éƒ¨çš„ `apple`ï¼Œä½† `let` è¦æ±‚å…ˆå£°æ˜å†ä½¿ç”¨ï¼Œå› æ­¤æŠ¥é”™ã€‚è¯¦è§ [Temporal Dead Zone](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#Temporal_dead_zone_and_errors_with_let)ã€‚


## å‡½æ•°æå‡
å‡½æ•°å£°æ˜ä¼šè¢«æå‡åˆ°æ‰€åœ¨ä½œç”¨åŸŸçš„é¡¶ç«¯ï¼Œå› æ­¤è°ƒç”¨è¯­å¥å¯ä»¥æ”¾åœ¨å‡½æ•°å£°æ˜ä¹‹å‰ã€‚
```javascript
(function() {

 Â sing();
  
  function sing() {
 Â  Â console.log('å°‘æ—åŠŸå¤«å¥½è€¶ çœŸå¥½è€¶ğŸ¸');
  }
  
})();
```
âš ï¸ å‡½æ•°è¡¨è¾¾å¼**ä¸ä¼š**è¢«æå‡ï¼Œå› æ­¤è¦å…ˆå£°æ˜å†è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
```javascript
(function() {
  
 Â var moon = function() { console.log('åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚'); }
  
 Â moon();  // æ­£å¸¸
 Â home();  // æŠ¥é”™ Uncaught TypeError: home is not a function
 Â 
 Â var home = function() { console.log('ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚'); }

})();
```

## æœ¬èŠ‚è¦ç‚¹
* `var` å˜é‡(çš„å£°æ˜)å’Œå‡½æ•°å£°æ˜ä¼šè¢«æå‡åˆ°æ‰€åœ¨ä½œç”¨åŸŸé¡¶ç«¯ã€‚
* `let` **ä¸å­˜åœ¨**å˜é‡æå‡ï¼Œå¿…é¡»å…ˆå£°æ˜å†ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
* å‡½æ•°è¡¨è¾¾å¼**ä¸ä¼š**è¢«æå‡ï¼Œå› æ­¤è¦å…ˆå£°æ˜å†è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

## æœ¬èŠ‚ç»ƒä¹ 
* ä»¥ä¸‹ä»£ç ä¸­ `console.log(s)` è¾“å‡ºä»€ä¹ˆï¼Ÿ
```javascript
var s = 'å‰ä¸è§å¤äºº';

(function() {
 Â console.log(s);
  
 Â var s = 'åä¸è§æ¥è€…';
})();
```
* ä»¥ä¸‹ä»£ç ä¸­ `console.log(m)` è¾“å‡ºä»€ä¹ˆï¼Ÿ
```javascript
(function() {

  if (false) {
 Â  Â var m = 'ğŸš«';
 Â }
  
  console.log(m);
})();
```

* ä»¥ä¸‹ä»£ç ä¸­ `console.log(t)` è¾“å‡ºä»€ä¹ˆï¼Ÿ
```javascript
(function() {
 Â t = 'ğŸ¯';

  if (false) {
    var t;
  }
  
  console.log(t);
})();
```

## å‚è€ƒé“¾æ¥
* http://es6.ruanyifeng.com
* https://javascript.info/var
* https://github.com/getify/You-Dont-Know-JS/issues/767
* https://developer.mozilla.org/en-US/docs/Glossary/Hoisting
* http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html
* https://rainsoft.io/variables-lifecycle-and-why-let-is-not-hoisted
* http://adripofjavascript.com/blog/drips/variable-and-function-hoisting
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let
* https://stackoverflow.com/questions/31219420/are-variables-declared-with-let-or-const-not-hoisted-in-es6
* https://medium.freecodecamp.org/what-is-variable-hoisting-differentiating-between-var-let-and-const-in-es6-f1a70bb43d

