# é—­åŒ… Closure

> A closure is the combination of a function and the lexical environment within which that function was declared.

é—­åŒ…çš„ä¸¤ä¸ªè¦ç´ 
* å‡½æ•°
* å‡½æ•°å£°æ˜æ—¶æ‰€å¤„çš„è¯æ³•ç¯å¢ƒ


```javascript
let name = "Tom"

function greet() {
  console.log(`Hi, ${name}!`)
}

name = "Sam"
```
```javascript
> greet()
  Hi, Sam!
```
ğŸ’¡ `console.dir(greet)` å¯æŸ¥çœ‹å‡½æ•°çš„ä½œç”¨åŸŸé“¾ã€‚

* æ¨¡æ‹Ÿç§æœ‰å±æ€§
```javascript
function createPerson(firstName, lastName) {
  return {
    setFirstName(first) { firstName = first },
    setLastName(last) { lastName = last },
    getFullName() { return `${firstName} ${lastName}` }
  }
}
```
```javascript
> let p = createPerson('Barack', 'Obama')

> p.getFullName()
â†’ "Barack Obama"

> p.setFirstName('Michelle')
â†’ undefined

> p.getFullName()
â†’ "Michelle Obama"
```
* åŠ¨æ€ç”Ÿæˆå‡½æ•°
```javascript
> ['ç‹ç»´', 'åˆ˜ç¦¹é”¡', 'ç‹å‹ƒ', 'ç™½å±…æ˜“', 'ç‹ä¹‹æ¶£', 'è´ºçŸ¥ç« ', 'é™ˆå­æ˜‚'].filter(name => name.startsWith('ç‹'))
â†’ ["ç‹ç»´", "ç‹å‹ƒ", "ç‹ä¹‹æ¶£"]
```
```javascript
function å§“(val) {
  return function(name) {
    return name.startsWith(val)
  }
}

> ['ç‹ç»´', 'åˆ˜ç¦¹é”¡', 'ç‹å‹ƒ', 'ç™½å±…æ˜“', 'ç‹ä¹‹æ¶£', 'è´ºçŸ¥ç« ', 'é™ˆå­æ˜‚'].filter(å§“('ç‹'))
â†’ ["ç‹ç»´", "ç‹å‹ƒ", "ç‹ä¹‹æ¶£"]

> 'ç‹ç»´', 'åˆ˜ç¦¹é”¡', 'ç‹å‹ƒ', 'ç™½å±…æ˜“', 'ç‹ä¹‹æ¶£', 'è´ºçŸ¥ç« ', 'é™ˆå­æ˜‚'].filter(å§“('åˆ˜'))
â†’ ["åˆ˜ç¦¹é”¡"]
```

## è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ
è¯æ³•ä½œç”¨åŸŸ(Lexical Scope)æ˜¯æŒ‡å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å…¶å®šä¹‰æ—¶å°±ç¡®å®šäº†ï¼Œå¤§éƒ¨åˆ†è¯­è¨€æ˜¯åŸºäºè¯æ³•ä½œç”¨åŸŸçš„ã€‚

åŠ¨æ€ä½œç”¨åŸŸ(Dynamic Scope)æ˜¯ä¸è¯æ³•ä½œç”¨åŸŸç›¸å¯¹çš„ï¼Œä½œç”¨åŸŸåœ¨å‡½æ•°è¿è¡Œæ—¶å€™å†³å®šã€‚

```javascript
let x = 1

function add(y) {
  return x + y
}

function sum(y) {
  let x = 3
 Â return add(y) Â   // å¦‚æœæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œåˆ™ add(y) è¿”å› 102
}
```

## çº¯(æ´çš„)å‡½æ•° Pure Function
ä¸€ä¸ªçº¯æ´çš„å‡½æ•°
```javascript
function sum(a, b) {
  return a + b
}
```
ä¸€ä¸ªä¸çº¯æ´çš„å‡½æ•°
```javascript
let c = 1

function sum(a, b) {
  return a + b + c
}
```

## Currying
Currying æ˜¯å°†å½¢å¦‚ `f(a, b, c)` çš„å‡½æ•°è½¬æ¢æˆ `f(a)(b)(c)` çš„å½¢å¼ã€‚
```javascript
function sum(a) {
  return function(b) {
    return a + b
  }
}
```
```javascript
> let onePlus = sum(1)

> onePlus(1)
â†’ 2

> onePlus(2)
â†’ 3
```


## Coursera è¯¾ç¨‹
* [åç››é¡¿å¤§å­¦ Programming Languages, Part A](https://www.coursera.org/learn/programming-languages)

## å‚è€ƒé“¾æ¥
* https://javascript.info/closure
* https://javascript.info/currying-partials
* https://en.wikipedia.org/wiki/Haskell_Curry
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures
