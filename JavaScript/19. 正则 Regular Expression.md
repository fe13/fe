# æ­£åˆ™ Regular Expression

æ­£åˆ™(è¡¨è¾¾å¼)æ˜¯æŸ¥æ‰¾ç‰¹å®šæ¨¡å¼å­—ç¬¦ä¸²çš„å¼ºå¤§å·¥å…·ï¼ŒJavaScript é€šè¿‡å†…ç½®çš„ `RegExp` æä¾›æ­£åˆ™æ”¯æŒã€‚

## åˆ›å»ºæ­£åˆ™
æ­£åˆ™æœ‰å¦‚ä¸‹ä¸¤ç§åˆ›å»ºæ–¹å¼
```javascript
> new RegExp('JavaScript')
â†’ /JavaScript/

> /JavaScript/
â†’ /JavaScript/

> new RegExp('javascript', 'i')
â†’ /javascript/i

> /javascript/i
â†’ /javascript/i
```

## åŒ¹é…æµ‹è¯•
```javascript
> /JavaScript/.test('The JavaScript Programming Language')
â†’ true

> /JavaScript/.test('the javascript programming language')
â†’ false

> new RegExp('javascript', 'i').test('The JavaScript Programming Language')
â†’ true

> /javascript/i.test('tTE jAVAsCRIPT pROGRAMMING lANGUAGE')
â†’ true
```
ğŸ’¡ `i` è¡¨ç¤ºå¯¹å¤§å°å†™ä¸æ•æ„Ÿ(case-**i**nsensitive)

`String.prototype.search()` æ–¹æ³•æ¥å—ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç”¨äºæœç´¢å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›é¦–ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ã€‚
```javascript
> 'The JavaScript Programming Language'.search(/JavaScript/)
â†’ 4

> 'The JavaScript Programming Language'.search(/javascript/)
â†’ -1
```

## åŒ¹é…é›†åˆ
åŒ¹é…ä¸­æ‹¬å· `[]` é‡Œçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦
```javascript
> /[0123456789]/.test('2017 NBA Finals')
â†’ true

> /[0-9]/.test('2017 NBA Finals')
â†’ true

> /\d/.test('2017 NBA Finals')
â†’ true
```
`[0123456789]` `[0-9]` `\d` æ˜¯ç­‰ä»·çš„

```javascript
> /æ‰“[ç¯®æ’ç½‘]çƒ/.test('æ‰“æ’çƒğŸ')
â†’ true

> /[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]/.test('Tiger')
â†’ true

> /[a-zA-Z]/.test('Monkey')
â†’ true
```
### å­—ç¬¦é›†åˆ
| ç¬¦å·  | å«ä¹‰Â  Â  Â  Â  Â  Â  Â  |
|------|-------------------|
| `.`  | ä»»æ„å­—ç¬¦é™¤äº†æ¢è¡Œç¬¦   |
| `\d` | `[0-9]` Â  Â  Â  Â  Â  |
| `\w` | `[a-zA-Z_]`       |
| `\s` | ç©ºæ ¼ï¼ŒTabï¼Œæ¢è¡Œç¬¦   |
| `\D` | éæ•°å­— `/[^0-9]/`  |
| `\W` | `[^a-zA-Z_]`      |
| `\S` | éç©ºç™½å­—ç¬¦ `[^\s]`  |

ğŸ’¡ `^` å°±æ˜¯ `é`

### å•è¯è¾¹ç•Œ
`\b` ç”¨äºåŒ¹é…å•è¯çš„è¾¹ç•Œ
```javascript
> 'I use Git'.match(/\bGit\b/)
â†’ ["Git", index: 6, input: "I use Git"]

> 'I use GitHub'.match(/\bGit\b/)
â†’ null
```

## åŒ¹é…é‡å¤

| ç¬¦å· Â  Â  | è¯´æ˜Â  Â        |
|---------|:--------------|
| `*` Â  Â  | é‡å¤ 0+ æ¬¡Â     |
| `+` Â  Â  | é‡å¤Â 1+ æ¬¡Â     |
| `?` Â  Â  | é‡å¤ 0 æˆ– 1 æ¬¡ |
| `{n}` Â  | é‡å¤Â n æ¬¡ Â  Â   |
| `{n,}`  | é‡å¤Â n+ æ¬¡ Â    |
| `{n,m}` | é‡å¤Â n åˆ° m æ¬¡Â |

```javascript
> 'View twhy on GitHub'.match(/View (\w+) on GitHub/)
â†’ ["View twhy on GitHub", "twhy", index: 0, input: "View twhy on GitHub"]

> 'From 2016-02-23 to 2017-10-01'.match(/\d{4}-\d{2}-\d{2}/g) Â  // æ³¨æ„ g 
â†’ ["2016-02-23", "2017-10-01"]

> '1 comment'.match(/^([\d,]+) comments?/)
â†’ ["1 comment", "1", index: 0, input: "1 comment"]

> '12 comments'.match(/^([\d,]+) comments?/)
â†’ ["12 comments", "12", index: 0, input: "12 comments"]

> 'chicken'.match(/duck/)
â†’ null
```
ğŸ’¡ `g` è¡¨ç¤ºå…¨å±€åŒ¹é…ï¼Œè€Œä¸ä»…ä»…æ˜¯åŒ¹é…ç¬¬ä¸€ä¸ª

### è´ªå©ªä¸æ‡’æƒ°
`/'.*'/g` ä¸­ `.*` æ˜¯è´ªå©ªçš„ï¼Œå› æ­¤
```javascript
> "We are both 'Greedy' and 'Lazy' ğŸ˜†".match(/'.+'/g)
â†’ ["'Greedy' and 'Lazy'"]
```
æˆ‘ä»¬å…¶å®æƒ³åŒ¹é… `'Greedy'` å’Œ `'Lazy'`ï¼Œå› æ­¤éœ€è¦ç»™ `.+` è®¾ç½®æ‡’æƒ°æ¨¡å¼æˆ `.+?`
```javascript
> "We are both 'Greedy' and 'Lazy' ğŸ˜†".match(/'.+?'/g)
â†’ ["'Greedy'", "'Lazy'"]
```
ä»¥ä¸‹æ­£åˆ™åŒæ ·å¯è¡Œ
```javascript
> "We are both 'Greedy' and 'Lazy' ğŸ˜†".match(/'[^']+'/g)
â†’ ["'Greedy'", "'Lazy'"]
```

## ç‰¹æ®Šå­—ç¬¦
`[ ] \ ^ $ . | ? * + ( )` è¿™äº›å­—ç¬¦åœ¨æ­£åˆ™ä¸­æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œå› æ­¤éœ€è¦è½¬ä¹‰ã€‚
```javascript
> '2017.08.27'.replace(/\./g, '-')
â†’ "2017-08-27"

> '3 * 4 * 5 = 60'.replace(/\*/g, 'x')
â†’ "3 x 4 x 5 = 60"

> '56 / 8 = 7'.replace(/\//, 'Ã·')
â†’ "56 Ã· 8 = 7"

> new RegExp('\\$\\d+\\.\\d+').test('$99.99')
â†’ true
```
`[]` ä¹‹é—´çš„ç‰¹æ®Šå­—ç¬¦ä¸€èˆ¬ä¸éœ€è¦è½¬ä¹‰
```javascript
> '(1 + 2) * 3 = 9'.match(/[-().*^+]/g)
â†’ ["(", "+", ")", "*"]
```

## æ•è·åˆ†ç»„
ç”¨ä¸€å¯¹æ‹¬å· `()` åŒ…å›´çš„æ¨¡å¼æ˜¯ä¸€ä¸ªåˆ†ç»„ã€‚
```javascript
> 'IP1:192.168.1.12 IP2:139.162.1.108'.match(/(\d{1,3}\.){3}\d{1,3}/g)
â†’ ["192.168.1.12", "139.162.1.108"]
```
åˆ†ç»„ç»“åˆ `String.prototype.replace()` ä½¿ç”¨ï¼Œ`$1` ä»£è¡¨ç¬¬ä¸€ä¸ªåˆ†ç»„æ•è·çš„å†…å®¹ï¼Œå¦‚æ­¤ç±»æ¨ã€‚
```javascript
> 'View FE13 on GitHub'.replace(/View ([\w-]+) on GitHub/, 'æŸ¥çœ‹ $1 çš„ GitHub ä¸»é¡µ')
â†’ "æŸ¥çœ‹ FE13 çš„ GitHub ä¸»é¡µ"

> '8 23, 2017'.replace(/(\d{1,2}) (\d{1,2}), (\d{4})/, '$3 å¹´ $1 æœˆ $2 æ—¥')
â†’ "2017 å¹´ 8 æœˆ 23 æ—¥"
```
ç±»ä¼¼çš„æœ‰ `\N` åœ¨æ­£åˆ™ä¸­å¼•ç”¨ç¬¬ N ä¸ªåˆ†ç»„çš„å†…å®¹ã€‚
```javascript
> 'Say "hello" and \'Goodbye\''.match(/("|')(\\?.)*?\1/g)
â†’ [""hello"", "'Goodbye'"]
```

ğŸ’¡ åˆ†ç»„æ˜¯å¯ä»¥åµŒå¥—çš„ã€‚
### æ’é™¤åˆ†ç»„
å¦‚æœä¸éœ€è¦åˆ†ç»„çš„å†…å®¹ï¼Œå¯ä»¥ç»™åˆ†ç»„æ·»åŠ  `?:` è¿›è¡Œæ’é™¤ã€‚ğŸ’¡ `()` ä¸­çš„ `|` è¡¨ç¤º `æˆ–`ã€‚
```javascript
> '1 repository'.replace(/^([\d,]+) repositor(?:y|ies)$/, '$1 ä¸ªä»“åº“')
â†’ "1 ä¸ªä»“åº“"

> '18 repositories'.replace(/^([\d,]+) repositor(?:y|ies)$/, '$1 ä¸ªä»“åº“')
â†’ "18 ä¸ªä»“åº“"

> 'on May 25'.match(/^on (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (?:\d+)$/)
â†’ ["on May 25", "May", index: 0, input: "on May 25"]
```

## å¼€å§‹ç»“æŸ
æ­£åˆ™ä¸­ `^` åŒ¹é…å­—ç¬¦ä¸²**å¼€å§‹**ï¼Œ`$` åŒ¹é…**ç»“æŸ**ã€‚
```javascript
> /^$/.test('')
â†’ true

> 'Delete demo'.replace(/Delete (\w+)$/, 'åˆ é™¤ $1')
â†’ "åˆ é™¤ demo"
```
ğŸ’¡ `^` `$` éƒ½åªæ˜¯åŒ¹é…ä½ç½®ã€‚

### å¤šè¡Œæ¨¡å¼
æ­£åˆ™çš„ `m` æ ‡è®° `/.../m` è¡¨ç¤ºå¤šè¡Œæ¨¡å¼ï¼Œå®ƒä¼šå½±å“ `^` å’Œ `$` çš„è¡¨ç°ã€‚
```javascript
let wwqx = `
æˆ‘é—»è¥¿æ–¹å¤§å£«ï¼Œ
ä¸ºäººäº†å´å‡¡å¿ƒã€‚
ç§‹æ¥æ˜æœˆç…§è“¬é—¨ï¼Œ
é¦™æ»¡ç¦…æˆ¿å¹½å¾„ã€‚
å±ˆæŒ‡çµå±±ä¼šåï¼Œ
å±…ç„¶ç´«ç«¹æˆæ—ã€‚
ç«¥ç”·ç«¥å¥³æ‹œè§‚éŸ³ï¼Œ
ä»†ä»†ä½•å«Œè£é¡¿ï¼Ÿ`

let wish = `
æ¯•ç”Ÿæ‰€å­¦ å‹‡å¾€ç›´å‰
ä¸šç²¾äºå‹¤ é”¦ç»£å‰ç¨‹
å¿«é©¬åŠ é­ å¿—æ‰ç›¸ä¼¼
ä¹å–„å¥½æ–½ ç‰é£Ÿè¡£é”¦`
```
```javascript
> wwqx.match(/^./g)
â†’ null

> wwqx.match(/^./gm).join('')
â†’ "æˆ‘ä¸ºç§‹é¦™å±ˆå±…ç«¥ä»†"

> wish.replace(/^(.).*(.)$/gm, '$1 $2')
â†’ `
  æ¯• å‰
  ä¸š ç¨‹
  å¿« ä¼¼
  ä¹ é”¦`
```

## å…ˆè¡Œæ–­è¨€ Lookahead
æ­£å‘å…ˆè¡Œæ–­è¨€(Positive Lookahead) `?=` ğŸŒ° `/N(?=B)/` åŒ¹é…å…¶åç´§éš `B` çš„ `N`
```javascript
> 'NAT NBC NCAA NFC NBA'.match(/N(?=B)/g)
â†’ ["N", "N"]

> '138-2340-6789 189-5782-6439'.match(/\d{3}(?=(-\d{4}){2})/g)
â†’ ["138", "189"]
```
è´Ÿå‘å…ˆè¡Œæ–­è¨€(Negative Lookahead) `?!`
```javascript
> 'NAT NBC NCAA NFC NBA'.match(/N(?!B)/g)
â†’ ["N", "N", "N"]

> 'Monday Sunday Monkey Mayday'.match(/([A-Z][a-z]{2})(?!key)/g)
â†’ ["Mon", "Sun", "May"]
```

## å¸¸ç”¨æ–¹æ³•
`String.prototype.split()`
```javascript
> 'Jan 23, 2014 Â  Aug 01, 2016 Â   Octo 15, 2017'.split(/\s{2,}/)
â†’ ["Jan 23, 2014", "Aug 01, 2016", "Octo 15, 2017"]
```
`String.prototype.replace()` å°±åƒ `Array.prototype.splice()` ä¸€æ ·å¤šæ‰å¤šè‰ºã€‚
```javascript
> ' Â  Â  å±±ä¸åœ¨é«˜ Â  æœ‰ä»™åˆ™å Â  Â  Â  Â   æ°´ä¸åœ¨æ·± Â   æœ‰é¾™åˆ™çµ Â   '.trim().replace(/\s+/g, ' ')
â†’ "å±±ä¸åœ¨é«˜ æœ‰ä»™åˆ™å æ°´ä¸åœ¨æ·± æœ‰é¾™åˆ™çµ"

> 'æç™½ æœç”« ç™½å±…æ˜“ åˆ˜ç¦¹é”¡ å­Ÿæµ©ç„¶'.replace(/[^ ]+/g, '$&å…ˆç”Ÿ')
â†’ "æç™½å…ˆç”Ÿ æœç”«å…ˆç”Ÿ ç™½å±…æ˜“å…ˆç”Ÿ åˆ˜ç¦¹é”¡å…ˆç”Ÿ å­Ÿæµ©ç„¶å…ˆç”Ÿ"

> 'é©¬Â·æ°å…‹ å¼ Â·å‰å§† æÂ·é²å‹ƒ é™ˆÂ·å±±å§† èµµÂ·ç½—æ–¯'.replace(/([^ ])(.)([^ ]+)/g, '$3$2$1')
â†’ "æ°å…‹Â·é©¬ å‰å§†Â·å¼  é²å‹ƒÂ·æ å±±å§†Â·é™ˆ ç½—æ–¯Â·èµµ"

> let m2n = { "Jan": "1", "Feb": "2", "Mar": "3", "Apr": "4",  "May": "5",  "Jun": "6", 
              "Jul": "7", "Aug": "8", "Sep": "9", "Oct": "10", "Nov": "11", "Dec": "12" }
              
> 'Nov'.replace(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/, (match) => `${m2n[match]} æœˆ`)
â†’ "11 æœˆ"

> 'Aug 28 2017'.replace(
    /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{1,2}) (\d{4})/,
    (match, p1, p2, p3) => `${p3} å¹´ ${m2n[p1]} æœˆ ${p2} æ—¥`
  )
â†’ "2017 å¹´ 8 æœˆ 28 æ—¥"
```
`RegExp.prototype.exec()` é€šå¸¸ä¸ `g` æ ‡è®°ç»“åˆä½¿ç”¨ã€‚
```javascript
> let lyrics = 'å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜'

> let piao = /é£˜/g

> piao.lastIndex
â†’ 0

> for (let result; result = piao.exec(lyrics);) console.log('piao.lastIndex', piao.lastIndex, result)
â†’ piao.lastIndex 2  ["é£˜", index: 1,  input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
  piao.lastIndex 4  ["é£˜", index: 3,  input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
  piao.lastIndex 8  ["é£˜", index: 7,  input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
  piao.lastIndex 11 ["é£˜", index: 10, input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
  piao.lastIndex 13 ["é£˜", index: 12, input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
  piao.lastIndex 17 ["é£˜", index: 16, input: "å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜ å¾—é£˜å¾—é£˜å¾—æ„çš„é£˜"]
```

## ç‰¹å®šä½ç½®
æ­£åˆ™çš„ `y` æ ‡è®°è¦æ±‚åŒ¹é…åªèƒ½å‡ºç°åœ¨ `regexp.lastIndex` æŒ‡å®šçš„ä½ç½®ã€‚
```javascript
> let regexp = /JavaScript/y

> regexp.lastIndex
â†’ 0

> regexp.exec('The JavaScript Programming Language')
â†’ null

> regexp.lastIndex = 4

> regexp.exec('The JavaScript Programming Language')
â†’ ["JavaScript", index: 4, input: "The JavaScript Programming Language"]
```

## source
æ­£åˆ™çš„ `source` å±æ€§å¯ç”¨äºå¤ç”¨å¸¸ç”¨æ­£åˆ™ã€‚
```javascript
> const MONTH_REGEXP = /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/

> new RegExp('on ' + MONTH_REGEXP.source + ' \\d+').test('on Aug 23')
â†’ true

> new RegExp(`Joined on ${MONTH_REGEXP.source} \\d+, \\d{4}`).test('Joined on Aug 23, 2016')
â†’ true
```

## unicode
æ­£å¸¸å­—ç¬¦éƒ½æ˜¯ 2 å­—èŠ‚ï¼Œä½†ä¹Ÿæœ‰ 4 ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œå¦‚ `ğ’³` æˆ–Â `ğŸ˜`ã€‚
```javascript
> 'x'.length
â†’ 1

> `ğ’³`.length
â†’ 2

> 'ğŸ˜'.length
â†’ 2
```
å¦‚æœéœ€è¦åŒ¹é…è¿™äº›å­—ç¬¦ï¼Œéœ€è¦ç»™æ­£åˆ™åŠ  `u` æ ‡è®°ã€‚
```javascript
> 'ğ’´'.match(/[ğ’³-ğ’µ]/u)
â†’ ["ğ’´", index: 0, input: "ğ’´"]

> 'ğŸ¤¡'.match(/ğŸ˜ğŸ˜‰ğŸ˜¡/u)
â†’ null
```

## åœ¨çº¿å·¥å…·
* http://regexr.com

## æ¼”è®²è§†é¢‘
* [Best of Fluent 2012: /Reg(exp){2}lained/: Demystifying Regular Expressions](https://www.youtube.com/watch?v=EkluES9Rvak)

## å‚è€ƒé“¾æ¥
* [æ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹](https://deerchao.net/tutorials/regex/regex.htm)
* [å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼](http://laifh.com/blog/post/123)
* http://eloquentjavascript.net/09_regexp.html
* http://javascript.info/regexp-introduction
* http://javascript.info/regexp-groups
* http://javascript.info/regexp-methods
* http://javascript.info/regexp-escaping
* http://javascript.info/regexp-anchors
* http://javascript.info/regexp-unicode
* http://javascript.info/regexp-quantifiers
* http://javascript.info/regexp-infinite-backtracking-problem
* http://javascript.info/regexp-character-classes
* http://www.regular-expressions.info/tutorial.html
* http://staynoob.cn/post/2017/01/regular-expression-lookahead-lookbehind
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search
* https://stackoverflow.com/questions/3075130/what-is-the-difference-between-and-regular-expressions

