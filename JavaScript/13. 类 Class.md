# ç±» Class

## é¢å‘å¯¹è±¡ç¼–ç¨‹
é¢å‘å¯¹è±¡ç¼–ç¨‹(Object-oriented programming)ï¼Œç®€ç§° OOPã€‚OOP ç®€å•æ¥è¯´å°±æ˜¯ç”¨å¯¹è±¡å¯¹ç°å®ä¸–ç•Œè¿›è¡Œå»ºæ¨¡è¿›è€Œè§£å†³é—®é¢˜ã€‚

## æ„é€ å™¨ Constructor
JavaScript æä¾›äº†æ„é€ å™¨(å‡½æ•°)ç”¨äºæ„é€ å¯¹è±¡ã€‚ğŸ’¡ æ„é€ å‡½æ•°åä¸€èˆ¬ä»¥å¤§å†™å¼€å¤´(é€šå¸¸æ˜¯åè¯)ï¼Œæ–¹ä¾¿ä¸æ™®é€šå‡½æ•°åŒºåˆ†ã€‚
```javascript
function Person(name, gender, height) {
  this.name = name;
  this.gender = gender;
  this.height = height;
}

// é™æ€æ–¹æ³• static method
Person.isPerson = function(person) {
  return !!(person && person.name);
};

// å®ä¾‹æ–¹æ³• instance method
Person.prototype.intro = function() {
  return `å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯${this.name}ã€‚`;
};

Person.prototype.sing = function(song) {
 Â return `æˆ‘è¦å”± ${song} ğŸ¤`;
};

Person.prototype.isTallerThan = function(person) {
 Â return person && person.height < this.height;
};
```
ä½¿ç”¨ `new` åˆ›å»ºæ–°å¯¹è±¡ã€‚
```javascript
> let eva = new Person('ä¾å¬…', 'å¥³', 168)
â†’ undefined

> eva.name
â†’ "ä¾å¬…"

> eva.sing('å€”å¼º')
â†’ "æˆ‘è¦å”± å€”å¼º ğŸ¤"
```
ä»¥ä¸Š `let eva = new Person('ä¾å¬…', 'å¥³', 168)` å®é™…æ•ˆæœå¦‚ä¸‹ã€‚
```javascript
let eva = Object.create(Person.prototype);
Person.call(eva, 'ä¾å¬…', 'å¥³', 168);
```
ğŸ’¡ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`Person.prototype.constructor` å±æ€§æŒ‡å‘ `Person`ã€‚è¯·ä¸¾ä¸€å Nã€‚
```javascript
> Person.prototype.constructor === Person
â†’ true

> eva.constructor === Person Â  Â  Â  // æ˜¾ç„¶ eva çš„æ„é€ å™¨æ˜¯ Person
â†’ true
```

### class
`ES6` æ–°å¢äº†Â `class` ç”¨äºç®€åŒ–ç±»çš„å£°æ˜ã€‚`static` ç”¨äºå£°æ˜é™æ€æ–¹æ³•ã€‚
```javascript
class Person {
  constructor(name, gender, height) {
    this.name = name;
    this.gender = gender;
    this.height = height;
  }
  
  static isPerson(person) {
    return !!(person && person.name);
  }
  
  intro() {
    return `å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯${this.name}ã€‚`;
  }
  
 Â sing(song) {
    return `æˆ‘è¦å”± ${song} ğŸ¤`;
  }
  
  isTallerThan(person) {
    return person && person.height < this.height;
  }
}
```

## ç»§æ‰¿ Inheritance
```javascript
function Artist(name, gender, height, agent) {
  Person.call(this, name, gender, height);
  this.agent = agent;
}

Artist.isArtist = function(artist) {
  return this.prototype.__proto__.constructor.isPerson(artist) && !!artist.agent;
};

Artist.prototype = Object.create(Person.prototype);
Artist.prototype.constructor = Artist;    // è®¾ç½®æ­£ç¡®çš„ constructor å€¼

Artist.prototype.sing = function(song) {
 Â return `${song} ä¼šå”±çš„ä¸€èµ·å”±å¥½å— ğŸ¸`;
};
```
```javascript
> let ashin = new Artist('é™ˆä¿¡å®', 'ç”·', 180, 'ç›¸ä¿¡éŸ³ä¹')
â†’ undefined

> ashin.name
â†’ "é™ˆä¿¡å®"

> ashin.agent
â†’ "ç›¸ä¿¡éŸ³ä¹"

> ashin.sing('æ‹çˆ±ing')
â†’ "æ‹çˆ±ing ä¼šå”±çš„ä¸€èµ·å”±å¥½å— ğŸ¸"

> ashin.isTallerThan(eva)
â†’ true
```
ä»¥ä¸Š `let ashin = new Artist('é™ˆä¿¡å®', 'ç”·', 180, 'ç›¸ä¿¡éŸ³ä¹')` å®é™…æ•ˆæœå¦‚ä¸‹ã€‚
```javascript
let ashin = Object.create(Artist.prototype);
Artist.call(ashin, 'é™ˆä¿¡å®', 'ç”·', 180, 'ç›¸ä¿¡éŸ³ä¹');
```

### extends
`ES6` æ–°å¢äº† `extends` ç”¨äºç®€åŒ–ç»§æ‰¿ã€‚`super` ç”¨äºè°ƒç”¨çˆ¶ç±»çš„é™æ€/å®ä¾‹æ–¹æ³•ã€‚
```javascript
class Artist extends Person {
  constructor(name, gender, height, agent) {
 Â  Â super(name, gender, height); Â   // constructor å†…ä½¿ç”¨ super é¡»æ”¾åœ¨ this å‰
 Â  Â this.agent = agent;
  }
  
  static isArtist(artist) {
 Â  Â return super.isPerson(artist) && !!artist.agent; Â   // super è°ƒç”¨çˆ¶ç±»é™æ€æ–¹æ³•
 Â }
  
  sing(song) {
    return `${song} ä¼šå”±çš„ä¸€èµ·å”±å¥½å— ğŸ¸`;
  }
}
```

## ç»§æ‰¿å…³ç³»
`instanceof` ç”¨äºåˆ¤æ–­æŒ‡å®šå¯¹è±¡æ˜¯å¦æŸä¸ªç±»çš„å®ä¾‹(åŒ…å«ç»§æ‰¿)ã€‚
```javascript
> eva instanceof Person
â†’ true

> eva instanceof Artist
â†’ false

> ashin instanceof Person
â†’ true

> ashin instanceof Artist
â†’ true
```
ğŸ’¡ `instanceof` é€šè¿‡æ£€æŸ¥æŒ‡å®šå¯¹è±¡çš„åŸå‹é“¾æ˜¯å¦åŒ…å«æ„é€ å™¨çš„ `prototype` å±æ€§è¿›è¡Œåˆ¤æ–­ã€‚

é€šè¿‡æ·»åŠ ä»¥ä¸‹ `Object.prototype.ctors()` æ–¹æ³•æŸ¥çœ‹ä»»æ„å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ã€‚ 
```javascript
Object.prototype.ctors = function(log = false) {
 Â let ctors = [];
  let proto = Object.getPrototypeOf(this);
  while (proto) {
    ctors.push(proto.constructor);
    proto = Object.getPrototypeOf(proto);
  }
 Â if (log) ctors.forEach(ctor => console.log(ctor.name));
  return ctors;
};
```
```javascript
> ashin.ctors(true)
  Artist
  Person
 Â Object
â†’ â–¶ï¸ (3) [function, function, function]
```

## é“¾å¼è°ƒç”¨
åœ¨å®ä¾‹æ–¹æ³•ä¸­ `return this` å¯ä»¥å®ç°é“¾å¼è°ƒç”¨ï¼Œè¿™ä¹Ÿæ˜¯ jQuery é“¾å¼è°ƒç”¨çš„åŸç†ã€‚
```javascript
class I {
  constructor(fact = '') {
 Â  Â this.fact = fact;
  }
  
 Â // ç§æœ‰æ–¹æ³•ä¸€èˆ¬ä»¥ä¸‹åˆ’çº¿å¼€å¤´
 Â _add(action) {
 Â  Â this.fact = this.fact ? `${this.fact} ${action}` : action;
 Â  Â return this;
 Â }
    
  work() {
 Â  Â return this._add('åŠªåŠ›å·¥ä½œ');
  }
 Â 
  promoted() {
 Â  Â return this._add('å‡èŒåŠ è–ª');
 Â }
  
  become(title) {
    if (title === 'æ€»ç»ç†') return this._add(`å½“ä¸Š${title}`);
    if (title === 'CEO') return this._add(`å‡ºä»»${title}`);
 Â }
  
  merry(mate) {
 Â  Â return this._add(`è¿å¨¶${mate}`);
 Â }
  
 Â peak() {
 Â  Â return this._add('èµ°ä¸Šäººç”Ÿå·…å³°');
  }
  
  excited() {
    return this._add('æƒ³æƒ³è¿˜æœ‰ç‚¹å°æ¿€åŠ¨');
 Â }
  
  wakeup() {
    this.fact = 'ä¸å¤šè¯´äº†ï¼Œå·¥å¤´å«æˆ‘å›å»æ¬ç –äº†ã€‚';
    return this;
  }
  
  reset() {
    this.fact = '';
    return this;
  }
}
```
ä½“éªŒä¸€ä¸‹èµ°å‘äººç”Ÿå·…å³°çš„æ„Ÿè§‰ã€‚
```javascript
> let i = new I();
â†’ undefined

> i.work().promoted().become('æ€»ç»ç†').become('CEO').merry('ç™½å¯Œç¾').peak().excited()
â†’ I {fact: "åŠªåŠ›å·¥ä½œ å‡èŒåŠ è–ª å½“ä¸Šæ€»ç»ç† å‡ºä»»CEO è¿å¨¶ç™½å¯Œç¾ èµ°ä¸Šäººç”Ÿå·…å³° æƒ³æƒ³è¿˜æœ‰ç‚¹å°æ¿€åŠ¨"}

> i.wakeup()
â†’ I {fact: "ä¸å¤šè¯´äº†ï¼Œå·¥å¤´å«æˆ‘å›å»æ¬ç –äº†ã€‚"}
```

## new.target

## å‚è€ƒé“¾æ¥
* https://javascript.info/instanceof
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/extends
* https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/class
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain

